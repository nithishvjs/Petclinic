trigger:
  - main

pool:
  vmImage: 'ubuntu-latest'

steps:
  - task: Maven@3
    inputs:
      mavenPomFile: 'pom.xml'
      goals: 'clean package'
    displayName: 'Build WAR with Maven'

  - script: |
      echo "Contents of target folder:"
      ls -al $(System.DefaultWorkingDirectory)/**/target/
    displayName: 'üîç Check target contents'
   

  - task: CopyFiles@2
    inputs:
      sourceFolder: '$(System.DefaultWorkingDirectory)'
      contents: '**/target/*.war'
      targetFolder: '$(Build.ArtifactStagingDirectory)'
      flattenFolders: true 
    displayName: 'Copy WAR to staging'

  - script: |
      echo "Contents of artifact staging:"
      ls -al $(Build.ArtifactStagingDirectory)
    displayName: 'üîç Check staging contents'

  - task: CopyFilesOverSSH@0
    inputs:
      sshEndpoint: 'Tomcat-SSH-Service'
      sourceFolder: '$(Build.ArtifactStagingDirectory)'
      contents: '*.war'
      targetFolder: '/opt/tomcat/webapps'
    displayName: 'Copy WAR to Tomcat webapps'




