resources:
  repositories:
    - repository: self
      type: github
      name: nithishvjs/Petclinic
      ref: main
      endpoint: nithishvjs  # ðŸ‘ˆ Ensure this matches your GitHub service connection name

trigger:
  - main

pool:
  vmImage: 'ubuntu-latest'

steps:
  # Step 1: Build with Maven
  - task: Maven@3
    inputs:
      mavenPomFile: 'pom.xml'
      goals: 'clean install test'
    displayName: 'Maven Build and Test'

  # Step 2: Publish Test Results to Azure DevOps
  - task: PublishTestResults@2
    inputs:
      testResultsFiles: '**/target/surefire-reports/TEST-*.xml'
      testRunTitle: 'Maven Test Results'
    displayName: 'Publish Test Results'

  # Step 3: Debug - List files in target folder
  - script: |
      echo "Checking target directory contents..."
      ls -al target/
    displayName: 'List Target Folder Contents'

  # Step 4: Copy the JAR file to the artifact staging directory
  - script: |
      mkdir -p $(Build.ArtifactStagingDirectory)
      cp target/*.war $(Build.ArtifactStagingDirectory)/ || echo "No WAR found"
    displayName: 'Copy WAR to Staging Directory'

  # Step 5: Publish the JAR file as a pipeline artifact
  - task: PublishPipelineArtifact@1
    inputs:
      targetPath: '$(Build.ArtifactStagingDirectory)'
      artifact: 'jar-artifact'
    displayName: 'Publish JAR Artifact'
